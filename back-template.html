<div style="display: none">{{Back}}</div>
{{^Video File Name*}}
<div class="container center" style="max-width: 100%; {{^Story* / Subtitle 1}}margin: auto 20px;{{/Story* / Subtitle 1}}">

{{#Picture}}
    {{#Story* / Subtitle 1}}<figure class="panel">{{Picture}}</figure>{{/Story* / Subtitle 1}}
    {{^Story* / Subtitle 1}}<div class="panel">{{Picture}}</div>{{/Story* / Subtitle 1}}
{{/Picture}}

{{^Story* / Subtitle 1}}
    <div class="large panel" {{#Sound}}id="frontPanel" style="display:none"{{/Sound}}>{{Front}}</div>
    {{#Sound}}<div class="large panel" id="frontPanel2" style="display: block;"><i class="fa fa-ellipsis-h"></i></div>{{/Sound}}
{{/Story* / Subtitle 1}}

{{^Story* / Subtitle 1}}
    <div id="typePanel" class="panel" style="display: none;">{{type:Front}}</div>
{{/Story* / Subtitle 1}}

{{#Audio File Name}}
    <div {{#Story* / Subtitle 1}}id="stickyHeader"{{/Story* / Subtitle 1}} class="panel">
        <div id="audioPanel" {{^Story* / Subtitle 1}}style="display: none;"{{/Story* / Subtitle 1}}>
            {{#Story* / Subtitle 1}}<div class="large padding">{{Front}}</div>{{/Story* / Subtitle 1}}
            <audio id="audioControl" controls loop class="small text-grenadine">
                <source src="{{Audio File Name}}">
                Your browser does not support the audio element.
            </audio>
            <form>
                <div class="range-slider small text-grey left">
                    <input id="pbr" class="range-slider__range" type="range" value="1" min="0.1" max="2" step="0.1" >
                    <span class="range-slider__value">Speed: <span id="currentPbr">1</span></span>
                </div>
            </form>
        </div>
    </div>
{{/Audio File Name}}

{{^Audio File Name}}
    {{#Story* / Subtitle 1}}<div class="large padding">{{Front}}</div>{{/Story* / Subtitle 1}}
{{/Audio File Name}}

    <hr class="text-grey">

{{#Back}}
    <div class="large panel">{{Back}}</div>
{{/Back}}

{{#Story* / Subtitle 1}}
    <div class="panel left newline">{{Story* / Subtitle 1}}</div>
{{/Story* / Subtitle 1}}

{{#Notes}}
    <div {{^Story* / Subtitle 1}}id="notesPanel"{{/Story* / Subtitle 1}} class="panel left newline padding round small grey" style="{{^Story* / Subtitle 1}}display: none;{{/Story* / Subtitle 1}}">{{Notes}}</div>
{{/Notes}}

</div>

{{#Tags}}
    <div class="tags xsmall text-grey">{{Tags}}</div>
{{/Tags}}

{{^Story* / Subtitle 1}}
    <div class="icon-bar">
        {{#Sound}}{{Sound}}{{/Sound}}
        {{#Sound}}<a title="Spell Checking" href="#" onclick="toggleType()"><i class="far fa-check-circle"></i></a>{{/Sound}}
        {{#Audio File Name}}<a title="Show Audio Player" href="#" onclick="toggleAudio()"><i class="fas fa-volume-up"></i></a>{{/Audio File Name}}
        {{#Sound}}<a title="Show Content of Front Side" href="#" onclick="toggleFront()"><i class="far fa-comment-dots"></i></a>{{/Sound}}
        {{#Notes}}<a title="See More Info" href="#" onclick="toggleNotes()"><i class="far fa-question-circle"></i></a>{{/Notes}}
    </div>
{{/Story* / Subtitle 1}}

<!-- Font Awesome Free's Cheatsheet: https://fontawesome.com/cheatsheet (load all styles) -->
<script src="_fontawesome-all.js"></script>
<script>

function toggleFront() {
  var x = document.getElementById("frontPanel");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
  var x = document.getElementById("frontPanel2");
  if (x.style.display === "block") {
    x.style.display = "none";
  } else {
    x.style.display = "block";
  }
}

function toggleAudio() {
  var x = document.getElementById("audioPanel");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}

function toggleType() {
  var x = document.getElementById("typePanel");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}

window.onload = function() {

  var v = document.getElementById("audioControl");
  var p = document.getElementById("pbr");
  var c = document.getElementById("currentPbr");

  p.addEventListener('input', function() {
    c.innerHTML = p.value;
    v.playbackRate = p.value;
  }, false);

};

function toggleNotes() {
  var x = document.getElementById("notesPanel");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}

{{#Audio File Name}}{{#Story* / Subtitle 1}}
window.onscroll = function () {
  stickyFunction()
};

var header = document.getElementById("stickyHeader");
var sticky = header.offsetTop;

function stickyFunction() {
  if (window.pageYOffset > sticky) {
    header.classList.add("sticky");
  } else {
    header.classList.remove("sticky");
  }
}
{{/Story* / Subtitle 1}}{{/Audio File Name}}

</script>
{{/Video File Name*}}

{{#Video File Name*}}
<div class="center">
    <video controls preload="metadata" src="{{Video File Name*}}" class="small text-grenadine">
        Your browser does not support the video element.
    </video>
    <div class="small">{{Front}}</div>
</div>

{{#Subtitle 2}}
    <!-- Content for Video Subtitle 2 -->
    <script type="text/vtt" data-label="Subtitle 2" data-lang="Sub2">{{Subtitle 2}}</script>
{{/Subtitle 2}}

{{#Story* / Subtitle 1}}
    <!-- Content for Video Subtitle 1 -->
    <script type="text/vtt" data-label="Subtitle 1" data-lang="Sub1">{{Story* / Subtitle 1}}</script>
{{/Story* / Subtitle 1}}

<script>
function parse_timestamp(s) {
  var match = s.match(/^(?:([0-9]+):)?([0-5][0-9]):([0-5][0-9](?:[.,][0-9]{0,3})?)/);
  if (match == null) {
    throw 'Invalid timestamp format: ' + s;
  }
  var hours = parseInt(match[1] || "0", 10);
  var minutes = parseInt(match[2], 10);
  var seconds = parseFloat(match[3].replace(',', '.'));
  return seconds + 60 * minutes + 60 * 60 * hours;
}

function quick_and_dirty_vtt_or_srt_parser(vtt) {
  var lines = vtt.trim().replace(/^[^\/]+\/\*!?/, "").replace(/\*\/[^\/]+$/, "");
  lines = lines.replace(/<\/div><div>/g, "\n").replace(/<div>/g, "\n").replace(/<\/div>/g, "\n").replace(/<br \/>/g, "\n").replace(/<br>/g, "\n");
  lines = lines.replace(/&nbsp;/g, " ").replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&amp;/g, "&");
  lines = lines.replace('\r\n', '\n');
  lines = lines.split(/[\r\n]/).map(function(line) {
    return line.trim();
  });
  var cues = [];
  var start = null;
  var end = null;
  var payload = null;
  for (var i = 0; i < lines.length; i++) {
    if (lines[i].indexOf('-->') >= 0) {
      var splitted = lines[i].split(/[ \t]+-->[ \t]+/);
      if (splitted.length != 2) {
        throw 'Error when splitting "-->": ' + lines[i];
      }
      start = parse_timestamp(splitted[0]);
      end = parse_timestamp(splitted[1]);
    } else if (lines[i] == '') {
      if (start && end) {
        var cue = new VTTCue(start, end, payload);
        cues.push(cue);
        start = null;
        end = null;
        payload = null;
      }
    } else if (start && end) {
      if (payload == null) {
        payload = lines[i];
      } else {
        payload += '\n' + lines[i];
      }
    }
  }
  if (start && end) {
    var cue = new VTTCue(start, end, payload);
    cues.push(cue);
  }
  return cues;
}

function init() {
  var video = document.querySelector('video');
  var subtitles = document.getElementsByTagName('script');
  Array.prototype.slice.call(subtitles)
    .filter(node => node.type === "text/vtt")
    .map(subtitle => {
      var track = video.addTextTrack('subtitles', subtitle.dataset.label, subtitle.dataset.lang);
      track.mode = "showing";
      quick_and_dirty_vtt_or_srt_parser(subtitle.innerHTML).map(function(cue) {
        track.addCue(cue);
      });
    });
}
init();
</script>
{{/Video File Name*}}
